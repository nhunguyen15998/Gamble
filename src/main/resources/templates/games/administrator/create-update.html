<htmllang="en" xmlns:th="http://www.thymeleaf.org"  >
<head th:replace="layouts/admin :: importLibs">
</head>
<body class="app sidebar-mini ltr transparent-mode bg-img1" data-new-gr-c-s-check-loaded="14.1071.0" data-gr-ext-installed="">
  <div class="horizontalMenucontainer">
    
    <div th:replace="layouts/admin :: switcher-wrapper"></div>
    <div th:replace="layouts/admin :: global-loader"></div>
    
    <div class="page">
        
    <script src="/ckeditor/ckeditor.js"></script>
        <div class="page-main is-expanded">
             <div th:replace="layouts/admin :: app-header"></div>
             <div th:replace="layouts/admin :: sticky"></div>
              <!--app-content open-->
              <div class="main-content app-content mt-0">

                <div class="side-app">
                    <!-- CONTAINER -->
                    <div class="main-container container-fluid">
                        <!-- PAGE-HEADER -->
                        <div class="page-header">
                            <h1 class="page-title" th:text="${formType==1?'Update':'Create'}"></h1>
                            <div>
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item"><a href="/admin/dashboard">Home</a>
                                    </li>
                                    <li class="breadcrumb-item"><a href="/admin/blog-categories/all">Games</a>
                                    </li>
                                    <li class="breadcrumb-item active" aria-current="page" th:text="${formType==1?'Update':'Create'}"></li>
                                </ol>
                            </div>
                        </div>
                        <!-- PAGE-HEADER END -->
                        <!-- ROW OPEN -->
                        <div class="row">
                            <div class="col-lg-12 col-md-12">
                                <div class="card" style="padding-bottom: 25px;">
                                    <div class="card-header">
                                        <h3 class="card-title">Infomation</h3> </div>
                                    <div class="card-body">
                                            <div class="form-row">
                                              <div class="col-xl-6 mb-3" style="display: none;">
                                                <input type="text" class="form-control" name="gameID" th:value="${oldData != null}?${oldData.id}:${gameMapper.id}" />
                                                <input type="text" class="form-control" name="configs" th:value="${configsList}" />

                                              </div>
                                              <div class="col-xl-4 mb-3">
                                                <label for="name" >Code</label>
                                                <input type="text" class="form-control" name="gameCode" th:value="${oldData != null}?${oldData.code}:${gameMapper.code}" >
                                                <small th:class="text-danger" id="code_err" style="font-size:14px;padding:0 5px;border-radius: 5px"></small>
                                               
                                            </div>
                                                <div class="col-xl-4 mb-3">
                                                    <label for="name" >Name</label>
                                                    <input type="text" class="form-control" name="gameName" th:value="${oldData != null}?${oldData.name}:${gameMapper.name}" >
                                                    <small th:class="text-danger" id="name_err" style="font-size:14px;padding:0 5px;border-radius: 5px"></small>
                                                   
                                                </div>
                                               
                                                <div class="col-xl-4 mb-3">
                                                    <label for="validationCustom04">Status</label>
                                                    <select class="form-control select2" name="gameStatus" id="validationCustom04">
                                                      <option th:each="stt : ${statusList}" 
                                                      th:value="${stt.key}" 
                                                      th:selected="(${oldData!=null}?${oldData.status}==${stt.key}:false) OR ${gameMapper.status}==${stt.key}"
                                                      th:text="${stt.value}" style="background-color:#8677d3;" ></option> 
                                                    </select>
                                                </div>
                                                <style>
                                                  .round{
                                                    padding:20px;
                                                    margin-bottom: 3vh;
                                                    display: table-row;
                                                  }
                                                  .round input{
                                                    background-color: rgba(233, 228, 238, 0.193);
                                                    border:none;
                                                    color: white;
                                                    margin-right:2vw;
                                                  }
                                                  input:focus{
                                                    outline: none;
                                                  }
                                                </style>
                                                <div class="col-xl-12 mb-3">
                                                    <label for="configs" >Configs</label>
                                                    <div class="col-xl-12 round form-control"  style="float:left"id="round1">
                                                    <label for="configs" >Round 1</label> <br/>
                                                    <table class="table">
                                                      <tr>
                                                        <th style="width:190px">Value</th>
                                                        <th style="width:190px">Background color</th>
                                                        <th>Text color</th>
                                                      </tr>
                                                      </table>

                                                    </div>
                                                    <div class="col-xl-12 round form-control"  style="float:left" id="round2">
                                                    <label for="configs" >Round 2</label> <br/>
                                                    <table class="table">
                                                      <tr>
                                                        <th style="width:190px">Value</th>
                                                        <th style="width:190px">Background color</th>
                                                        <th>Text color</th>
                                                      </tr>
                                                      </table>
                                                    </div>
                                                    <div class="col-xl-12 round form-control" style="float:left" id="round3">
                                                    <label for="configs" >Round 3</label> <br/>
                                                    <table class="table">
                                                      <tr>
                                                        <th style="width:190px">Value</th>
                                                        <th style="width:190px">Background color</th>
                                                        <th>Text color</th>
                                                      </tr>
                                                      </table>
                                                    </div>
                                                    <small th:class="text-danger" id="configs_err" style="font-size:14px;padding:0 5px;border-radius: 5px"></small>
                                                   
                                                </div>
                                            </div>
                                            
                                               
                                            <div class="alert" id="msgUpdated" style="display: none;"></div>
                                              
                                            <span class="btn btn-primary" style="margin:4vh 0 auto 0;" onclick="SaveConfigs()" type="submit">Save</span>
                                            </div>
                                            
                                    </div>
                                </div>
                            </div>
                    
                        </div>
                        <!-- ROW CLOSED -->
                    </div>
        
                 <!-- CONTAINER END -->
                 </div>
              </div>
            <!--app-content close-->
            
        </div>
            <div th:replace="layouts/admin :: sidebar-right"></div>
            <div th:replace="layouts/admin :: country-selector"></div>
            <footer th:replace="layouts/admin :: footer" ></footer>
    </div>
    

    <a href="#top" id="back-to-top"><i class="fa fa-angle-up"></i></a>
    <svg id="SvgjsSvg1001" width="2" height="0" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs" style="overflow: hidden; top: -100%; left: -100%; position: absolute; opacity: 0;">
      <defs id="SvgjsDefs1002"></defs>
      <polyline id="SvgjsPolyline1003" points="0,0"></polyline>
      <path id="SvgjsPath1004" d="M0 0 "></path>
    </svg>
    

 <!-- JQUERY JS -->
  
  <noscript>
  
  <p>
  To display this page you need a browser that supports JavaScript.</p>
  
  </noscript>
  
  <script src="/assets/js/jquery.min.js">
  </script>
  <script type="text/javascript">
  </script>
  
  <!-- BOOTSTRAP JS -->
  
  <noscript>
  
  <p>
  To display this page you need a browser that supports JavaScript.</p>
  
  </noscript>
  <script src="/assets/plugins/bootstrap/js/popper.min.js">
  </script>
  
  <script type="text/javascript">
  
  
  </script>
  
  <noscript>
  
  <p>
  To display this page you need a browser that supports JavaScript.</p>
  
  </noscript>
  
  <script src="/assets/plugins/bootstrap/js/bootstrap.min.js">
  </script>
  
  <script type="text/javascript">
  
  </script>
  
  <!-- SPARKLINE JS-->
  <noscript>
  <p>
  To display this page you need a browser that supports JavaScript.</p>
  </noscript>
  <script src="/assets/js/jquery.sparkline.min.js">
  </script>
  <script type="text/javascript">
  
  </script>
  <!-- Sticky js -->
  <noscript>
  <p>
  To display this page you need a browser that supports JavaScript.</p>
  </noscript>
  <script src="/assets/js/sticky.js">
  </script>
  <script type="text/javascript">
  
  </script>
  <!-- CHART-CIRCLE JS-->
  <noscript>
  <p>
  To display this page you need a browser that supports JavaScript.</p>
  </noscript>
  <script type="text/javascript">
  
  </script>
  <!-- PIETY CHART JS-->
  <noscript>
  <p>
  To display this page you need a browser that supports JavaScript.</p>
  </noscript>
  <script src="/assets/plugins/peitychart/jquery.peity.min.js">
  </script>
  <script type="text/javascript">
  
  </script>
  <noscript>
  <p>
  To display this page you need a browser that supports JavaScript.</p>
  </noscript>
  <script src="/assets/plugins/peitychart/peitychart.init.js">
  </script>
  <script type="text/javascript">
  
  </script>
  <!-- SIDEBAR JS -->
  <noscript>
  <p>
  To display this page you need a browser that supports JavaScript.</p>
  </noscript>
  <script src="/assets/plugins/sidebar/sidebar.js">
  </script>
  <script type="text/javascript">
  
  </script>
  <!-- Perfect SCROLLBAR JS-->
  <noscript>
  <p>
  To display this page you need a browser that supports JavaScript.</p>
  </noscript>
  <script src="/assets/plugins/p-scroll/perfect-scrollbar.js">
  </script>
  <script type="text/javascript">
  
  </script>
  <noscript>
  <p>
  To display this page you need a browser that supports JavaScript.</p>
  </noscript>
  <script src="/assets/plugins/p-scroll/pscroll.js">
  </script>
  <script type="text/javascript">
  
  </script>
  <noscript>
  <p>
  To display this page you need a browser that supports JavaScript.</p>
  </noscript>
  <script src="/assets/plugins/p-scroll/pscroll-1.js">
  </script>
  <script type="text/javascript">
  
  </script>
  <!-- INTERNAL CHARTJS CHART JS-->
  <noscript>
  <p>
  To display this page you need a browser that supports JavaScript.</p>
  </noscript>
  <script type="text/javascript">
  
  </script>
  <noscript>
  <p>
  To display this page you need a browser that supports JavaScript.</p>
  </noscript>
  
  <script type="text/javascript">
  
  </script>
   <noscript>
    <p>
    To display this page you need a browser that supports JavaScript.</p>
    </noscript>
  <script src="/assets/plugins/chart/utils.js">
    </script>
  <script type="text/javascript">
  
  </script>
   <!-- INTERNAL SELECT2 JS -->
   <noscript>
    <p>
    To display this page you need a browser that supports JavaScript.</p>
    </noscript>
  <script src="/assets/plugins/select2/select2.full.min.js">
    </script>
  <script type="text/javascript">
  
  </script>
   <!-- INTERNAL Data tables js-->
   <noscript>
    <p>
    To display this page you need a browser that supports JavaScript.</p>
    </noscript>
  <script src="/assets/plugins/datatable/js/jquery.dataTables.min.js">
    </script>
  <script type="text/javascript">
  
  </script>
   <noscript>
    <p>
    To display this page you need a browser that supports JavaScript.</p>
    </noscript>
  <script src="/assets/plugins/datatable/js/dataTables.bootstrap5.js">
    </script>
  <script type="text/javascript">
  
  </script>
   <noscript>
    <p>
    To display this page you need a browser that supports JavaScript.</p>
    </noscript>
  <script src="/assets/plugins/datatable/dataTables.responsive.min.js">
    </script>
  <script type="text/javascript">
  
  </script>
   <!-- INTERNAL APEXCHART JS -->
   <noscript>
    <p>
    To display this page you need a browser that supports JavaScript.</p>
    </noscript>
  <script src="/assets/js/apexcharts.js">
    </script>
  <script type="text/javascript">
  
  </script>
   <noscript>
    <p>
    To display this page you need a browser that supports JavaScript.</p>
    </noscript>
  <script src="/assets/plugins/apexchart/irregular-data-series.js">
    </script>
  <script type="text/javascript">
  
  </script>
   <!-- INTERNAL Flot JS -->
   <noscript>
    <p>
    To display this page you need a browser that supports JavaScript.</p>
    </noscript>
  
  <script type="text/javascript">
  
  </script>
   <noscript>
    <p>
    To display this page you need a browser that supports JavaScript.</p>
    </noscript>

  <script type="text/javascript">
  
  </script>
   <noscript>
    <p>
    To display this page you need a browser that supports JavaScript.</p>
    </noscript>
  
  <script type="text/javascript">
  
  </script>
   <noscript>
    <p>
    To display this page you need a browser that supports JavaScript.</p>
    </noscript>
  <script src="/assets/plugins/flot/dashboard.sampledata.js">
    </script>
  <script type="text/javascript">
  
  </script>
   <!-- INTERNAL Vector js -->
   <noscript>
    <p>
    To display this page you need a browser that supports JavaScript.</p>
    </noscript>
  <script src="/assets/plugins/jvectormap/jquery-jvectormap-2.0.2.min.js">
    </script>
  <script type="text/javascript">
  
  </script>
   <noscript>
    <p>
    To display this page you need a browser that supports JavaScript.</p>
    </noscript>
  <script src="/assets/plugins/jvectormap/jquery-jvectormap-world-mill-en.js">
    </script>
  <script type="text/javascript">
   
  </script>
   <!-- SIDE-MENU JS-->
   <noscript>
    <p>
    To display this page you need a browser that supports JavaScript.</p>
    </noscript>
  <script src="/assets/plugins/sidemenu/sidemenu.js">
    </script>
  <script type="text/javascript">
  
  </script>
   <!-- TypeHead js -->
   <noscript>
    <p>
    To display this page you need a browser that supports JavaScript.</p>
    </noscript>
  <script src="/assets/plugins/bootstrap5-typehead/autocomplete.js">
    </script>
  <script type="text/javascript">
  
  </script>
   <noscript>
    <p>
    To display this page you need a browser that supports JavaScript.</p>
    </noscript>
  <script src="/assets/js/typehead.js">
    </script>
  <script type="text/javascript">
  
  </script>
   <!-- INTERNAL INDEX JS -->
   <noscript>
    <p>
    To display this page you need a browser that supports JavaScript.</p>
    </noscript>
 
  <script type="text/javascript">
  
  </script>
   <!-- Color Theme js -->
   <noscript>
    <p>
    To display this page you need a browser that supports JavaScript.</p>
    </noscript>
  <script src="/assets/js/themeColors.js">
    </script>
  <script type="text/javascript">
    
  </script>
   <!-- CUSTOM JS -->
   <noscript>
    <p>
    To display this page you need a browser that supports JavaScript.</p>
    </noscript>
  <script src="/assets/js/custom.js">
    </script>
  <script type="text/javascript">
  
  </script>
   <!-- Switcher js -->
   <noscript>
    <p>
    To display this page you need a browser that supports JavaScript.</p>
    </noscript>
  <script src="/assets/switcher/js/switcher.js">
    </script>
    <svg id="SvgjsSvg1001" width="2" height="0" xmlns="http://www.w3.org/2000/svg" version="1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:svgjs="http://svgjs.com/svgjs" style="overflow: hidden; top: -100%; left: -100%; position: absolute; opacity: 0;">
      <defs id="SvgjsDefs1002">
      </defs>
      <polyline id="SvgjsPolyline1003" points="0,0">
      </polyline>
      <path id="SvgjsPath1004" d="M0 0 ">
      </path>
      </svg>
   
  </div>
          <div class="jvectormap-tip">
            </div>
    
        </body>
        <grammarly-desktop-integration data-grammarly-shadow-root="true"></grammarly-desktop-integration>
</body>

<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script> -->

<script>
   $(window).on('load', function(){
    onLoad();
   })

   async function onLoad(){
    let response = await $.get('/getSliceArrays', (response) => {
        return response
    }).fail((data) => {
        console.log(data)
    })
    //content
    slices1 = response.slices1
    slices2 = response.slices2
    slices3 = response.slices3
    //background color
    colors1 = response.colors1
    colors2 = response.colors2
    colors3 = response.colors3
    //text color
    textColors1 = response.textColors1
    textColors2 = response.textColors2
    textColors3 = response.textColors3
    var string='';

    jQuery.each( slices1, function( i, val ) {
      string='<div style="float:left"  class="form-control mb-3"><input style="float:left" class="valueRound"  type="text" value="'+val+'"/>';
        jQuery.each( colors1, function( i1, val1 ) {
          if(i1==i)  string+='<div style="float:left"><input type="text" value="'+val1+'" class="bgColor"/><div class="bgColorDiv" style="width:calc(100% - 2vw);height:22px; background-color:'+val1+'"></div></div>';
        });
        jQuery.each( textColors1, function( i2, val2 ) {
          if(i2==i) string+='<div style="float:left"><input type="text" value="'+val2+'" class="txtColor"/> <div class="colorDiv" style="width:calc(100% - 2vw);height:22px; background-color:'+val2+'"></div> </div>';
        });
         $("#round1").append(string+'<label class="text-danger text-danger-value"></label></div><br/>')
    });
    jQuery.each( slices2, function( i, val ) {
        string='<div style="float:left"  class="form-control mb-3"><input style="float:left" class="valueRound" type="text" value="'+val+'"/>';
          jQuery.each( colors2, function( i1, val1 ) {
          if(i1==i)  string+='<div style="float:left"><input type="text" value="'+val1+'" class="bgColor"/><div class="bgColorDiv" style="width:calc(100% - 2vw);height:22px; background-color:'+val1+'"></div></div>';
        });
        jQuery.each( textColors2, function( i2, val2 ) {
          if(i2==i) string+='<div style="float:left"><input type="text" value="'+val2+'" class="txtColor"/> <div class="colorDiv" style="width:calc(100% - 2vw);height:22px; background-color:'+val2+'"></div> </div>';

        });
         $("#round2").append(string+'<label class="text-danger text-danger-value"></label></div><br/>')

    });
    jQuery.each( slices3, function( i, val ) {
        string='<div style="float:left"  class="form-control mb-3"><input style="float:left" class="valueRound"  type="text" value="'+val+'"/>';
          jQuery.each( colors3, function( i1, val1 ) {
          if(i1==i)  string+='<div style="float:left"><input type="text" value="'+val1+'" class="bgColor"/><div class="bgColorDiv" style="width:calc(100% - 2vw);height:22px; background-color:'+val1+'"></div></div>';
        });
        jQuery.each( textColors3, function( i2, val2 ) {
          if(i2==i) string+='<div style="float:left"><input type="text" value="'+val2+'" class="txtColor"/> <div class="colorDiv" style="width:calc(100% - 2vw);height:22px; background-color:'+val2+'"></div> </div>';

        });
        $("#round3").append(string+'<label class="text-danger text-danger-value"></label></div><br/>')
    });
    
   }
   $('body').delegate(".valueRound", "change", function () {
          checkValue($(this));
    });
    $('body').delegate(".bgColor", "change", function () {
        checkHEX($(this));
    });
    $('body').delegate(".bgColor", 'keyup', function (e) {
    if (e.key === 'Enter' || e.keyCode === 13)  checkHEX($(this));
    });
    $('body').delegate(".txtColor", 'keyup', function (e) {
    if (e.key === 'Enter' || e.keyCode === 13)  checkHEX($(this));
    });
    $('body').delegate(".valueRound", 'keyup', function (e) {
    if (e.key === 'Enter' || e.keyCode === 13)  checkValue($(this));
    });
    $('body').delegate(".txtColor", "change", function () {
      checkHEX($(this));
    });

      function checkValue(ele){
        var str=$(ele).val();
        var double =(parseFloat((str.replace('X','')))||parseFloat((str.replace('+','')))||parseFloat((str.replace('รท',''))));
        var dot = (!str.includes('0')||(str.includes('.0'))||(str.includes('0')&&str.length==2))?true:(str.includes('0.'))
          if(!(((str.includes("+")||str.includes("รท")||str.includes("X"))&&double&&dot)||str=="NEXT")){
            $(ele).parent().find('label').html('Value is incorrect');
          }else{
            $(ele).parent().find('label').html('');
          }
      }
      
      function checkHEX(ele){
        var str=$(ele).val();
          let regex= /^#([A-F0-9]{3,4}|[A-F0-9]{6}|[A-F0-9]{8})$/i;
          if(!regex.test(str)){
            $(ele).parent().parent().find('label').html('HEX value is incorrect');
          }else {$(ele).parent().parent().find('label').html('');
          $(ele).parent().find('div').css('background-color',str)}
      }
      function SaveConfigs(){
        error =$('.text-danger-value');
        var check=true;
        for (var i = 0, n = error.length; i < n; i++) {
          if($(error[i]).html()!=''){ check = false; break;}
        }

        $("#msgUpdated").removeClass("alert-warning");
        $("#msgUpdated").removeClass("alert-success");
        $("#msgUpdated").html('');

        if(check==true){
        //GET JSON STRING
        var res ='';
        for(var i = 1; i<=3;i++ ){
          var round = '{"labels":[';
          $("#round"+i).find(".valueRound").each(function(index, element) {
            if(index==($("#round"+i).find(".valueRound").length - 1))
                    round += '"'+ $(element).val()+'"],';
            else    round += '"'+ $(element).val()+'",';
            });
           round += '"backgroundColors":[';
          $("#round"+i).find(".bgColor").each(function(index, element) {
            if(index==($("#round"+i).find(".bgColor").length - 1))
                    round += '"'+ $(element).val()+'"],';
            else    round += '"'+ $(element).val()+'",';
          });
          round += '"textColors":[';
          $("#round"+i).find(".txtColor").each(function(index, element) {
            if(index==($("#round"+i).find(".txtColor").length - 1))
                    round +=  '"'+ $(element).val()+'"]}'+ (i==3?'':'\\');
            else    round += '"'+ $(element).val()+'",';
          });
          res+=round;
        }
        console.log(res);
        
        let data = {
        "id": $('input[name="gameID"]').val(),
        "code": $('input[name="gameCode"]').val(),
        "name": $('input[name="gameName"]').val(),
        "status": $('input[name="gameStatus"]').val(),
        "configs":res
        }
        console.log(JSON.stringify(data))
          $.ajax({
            url: '/admin/games/update',
            type: 'post',
            data: JSON.stringify(data),
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            success: function(response){
          console.log(response)
            $('#name_err').text("")
            $('#code_err').text("")
            $("#msgUpdated").addClass('alert-success');
            $("#msgUpdated").html('Saved successfully !');
            
        },
        error: function(data){
            console.log(data)
            data.responseJSON.errors.forEach(err => {
                $(`#${err.field}_err`).text(err.defaultMessage ?? "")
                $("#msgUpdated").addClass('alert-warning');
                $("#msgUpdated").html('Please check the input data !');
            })
        }
          });
      }else{
        $("#msgUpdated").addClass('alert-warning');
        $("#msgUpdated").html('Please check the input data !');
      }
  
      $("#msgUpdated").css("display", "block");
      $("#msgUpdated").delay(4000).fadeOut(300);  
 }
</script>